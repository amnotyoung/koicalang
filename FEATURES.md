# Koica Lang - 기능 상세 설명

## 🎯 핵심 기능

### 1. 음성 대화 연습

실시간 음성 인식과 AI 응답을 통한 자연스러운 대화 연습

**사용 흐름:**
1. 사용자가 마이크 버튼을 눌러 크메르어로 말하기
2. STT (Speech-to-Text)가 음성을 텍스트로 변환
3. LLM (Gemini)이 대화 맥락을 분석하고 적절한 응답 생성
4. TTS (Text-to-Speech)가 응답을 자연스러운 음성으로 변환
5. 사용자가 AI 음성 응답을 듣고 대화 계속

**기술 구현:**
- `POST /api/v1/conversation/voice-conversation`
- Google Cloud Speech-to-Text API (크메르어 지원)
- Google Gemini Pro (다국어 대화 엔진)
- Google Cloud Text-to-Speech API

---

### 2. 발음 평가 시스템

사용자의 발음을 정확도, 자연스러움, 속도 등 다각도로 평가

**평가 항목:**
- **정확도 점수** (0-100): STT 신뢰도 + 텍스트 유사도 + 단어별 점수
- **자연스러움 점수**: LLM이 평가한 발화의 자연스러움
- **단어별 분석**: 각 단어의 발음 정확도와 개선 필요 단어 식별
- **개선 제안**: 구체적이고 실천 가능한 피드백

**기술 구현:**
- `POST /api/v1/voice/evaluate-pronunciation`
- STT word confidence 분석
- LLM 기반 발음 피드백
- 유사도 알고리즘 (difflib.SequenceMatcher)

---

### 3. 시나리오 기반 학습

실제 봉사 현장에서 자주 마주치는 상황별 대화 연습

#### 📍 시나리오 1: 시장에서 장보기

**학습 목표:**
- 가격 묻기 및 흥정하기
- 신선도 확인하기
- 감사 인사하기

**핵심 표현:**
- "នេះថ្លៃប៉ុន្មាន?" (이것 얼마예요?)
- "សុំថោកបន្តិចបានទេ?" (좀 깎아주실 수 있나요?)
- "ស្រស់ទេ?" (신선한가요?)

#### 🛺 시나리오 2: 뚝뚝(툭툭) 이용하기

**학습 목표:**
- 목적지 설명하기
- 요금 협상하기
- 길 안내하기

**핵심 표현:**
- "ទៅ... ប៉ុន្មាន?" (...까지 얼마예요?)
- "ឆ្ងាយប៉ុន្មាន?" (얼마나 멀어요?)
- "បត់ឆ្វេង/ស្ដាំ" (왼쪽/오른쪽으로 도세요)

#### 💼 시나리오 3: 현지 동료와 인사

**학습 목표:**
- 존댓말 사용하기
- 업무 관련 대화
- 감사와 부탁 표현

**핵심 표현:**
- "ជំរាបសួរ លោក/លោកស្រី" (안녕하세요 - 공손)
- "សុខសប្បាយទេ?" (잘 지내세요?)
- "សុំជួយផង" (도와주세요)

**기술 구현:**
- `GET /api/v1/scenarios/list` - 시나리오 목록
- `GET /api/v1/scenarios/{id}` - 시나리오 상세
- `GET /api/v1/scenarios/{id}/start` - 대화 시작

---

### 4. 음성 중심 UI/UX

텍스트 읽기 부담을 최소화하고 말하기와 듣기에 집중

**디자인 원칙:**
- ✅ 큰 터치 가능 버튼 (최소 44x44px)
- ✅ 음성 녹음 상태를 명확히 표시
- ✅ 실시간 피드백 및 진행 상황
- ✅ 텍스트는 보조 수단으로만 사용
- ✅ 모바일 친화적 레이아웃

**주요 컴포넌트:**
- `VoiceRecorder.jsx` - 음성 녹음 버튼
- `ConversationUI.jsx` - 대화 인터페이스
- `ScenarioSelector.jsx` - 시나리오 선택

---

## 🔄 데이터 흐름

### 전체 음성 대화 흐름

```
[사용자 음성]
    ↓
[브라우저 MediaRecorder API - 녹음]
    ↓
[Blob → FormData]
    ↓
[POST /api/v1/conversation/voice-conversation]
    ↓
[백엔드: STT Service]
    ↓ (크메르어 텍스트)
[백엔드: LLM Service - Gemini]
    ↓ (크메르어 응답 텍스트)
[백엔드: TTS Service]
    ↓ (MP3 오디오)
[Base64 인코딩 → JSON 응답]
    ↓
[프론트엔드: Base64 디코딩 → Blob]
    ↓
[Audio 태그 재생]
    ↓
[사용자가 듣기]
```

---

## 📊 발음 평가 알고리즘

### 종합 점수 계산

```python
overall_score = (
    stt_confidence * 0.4 +      # STT 신뢰도 (40%)
    similarity_score * 0.3 +     # 텍스트 유사도 (30%)
    avg_word_confidence * 0.3    # 평균 단어 신뢰도 (30%)
)
```

### 등급 체계

- **A (90-100)**: 매우 우수 - 원어민 수준
- **B (80-89)**: 우수 - 자연스러운 발음
- **C (70-79)**: 양호 - 의사소통 가능
- **D (60-69)**: 보통 - 연습 필요
- **F (0-59)**: 연습 필요 - 기초부터 다시

---

## 🚀 향후 기능 확장

### 단기 계획 (1-2개월)

- [ ] 라오어, 베트남어 지원 추가
- [ ] 학습 진도 추적 및 통계
- [ ] 일일 학습 목표 및 알림
- [ ] 오프라인 모드 지원

### 중기 계획 (3-6개월)

- [ ] 게임화 요소 (배지, 포인트)
- [ ] 봉사단원 간 대화 연습 매칭
- [ ] 문화 컨텍스트 학습 자료
- [ ] 현지인 음성 샘플 데이터베이스

### 장기 계획 (6개월+)

- [ ] 모바일 앱 (iOS/Android)
- [ ] 증강현실(AR) 학습 경험
- [ ] 음성 비서 통합
- [ ] 다국어 동시 학습 지원

---

## 🔒 보안 및 개인정보

- 음성 데이터는 전송 후 즉시 처리되며 서버에 저장되지 않음
- Google Cloud API는 GDPR 준수
- 사용자 학습 기록은 암호화되어 저장
- API 키는 환경 변수로 관리, Git에 커밋되지 않음
